<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UHE Teles Pires - Monitor de Gera√ß√£o</title>
    <link rel="stylesheet" href="css/styles.css">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <!-- SheetJS -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- Supabase Config (crie este arquivo seguindo docs/SUPABASE-SETUP.md) -->
    <script src="js/supabase-config.js"></script>
    <script>
        window.SUPABASE_CONFIG = {
            url: 'https://shjbfriuqrwbnqochybz.supabase.co',
            anonKey: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNoamJmcml1cXJ3Ym5xb2NoeWJ6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI2OTM3MzksImV4cCI6MjA3ODI2OTczOX0.B7ruEe_2DVL1CTk6syi3vOB1BP05euhVYMTtBA1DJsM'
        };
    </script>

</head>
<body>
    <div class="container">
        <!-- Cabe√ßalho -->
        <header class="header">
            <div style="flex: 1;">
                <h1 id="pageTitle">UHE Teles Pires - Desempenho da Gera√ß√£o</h1>
                <div class="no-print" style="margin-top: 10px;">
                    <label for="reportDate" style="font-size: 0.875rem; color: #666; margin-right: 8px;">Data:</label>
                    <input type="date" id="reportDate" style="padding: 6px 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 0.875rem;">
                </div>
            </div>
            <div class="header-actions no-print">
                <button id="editorBtn" class="btn btn-secondary">Editar Dados</button>
                <button id="printBtn" class="btn btn-success">Imprimir Relat√≥rio</button>
            </div>
        </header>

        <!-- KPIs -->
        <div class="kpi-grid">
            <div class="kpi-card kpi-purple">
                <div class="kpi-icon">üìä</div>
                <div class="kpi-content">
                    <div class="kpi-label">Desvio M√©dio</div>
                    <div class="kpi-value" id="desvioMedio">-- MW</div>
                </div>
            </div>
            <div class="kpi-card kpi-green">
                <div class="kpi-icon">‚ö°</div>
                <div class="kpi-content">
                    <div class="kpi-label">Pico de Gera√ß√£o</div>
                    <div class="kpi-value" id="picoGeracao">-- MW</div>
                    <div class="kpi-subtitle" id="picoHorario">--:--</div>
                </div>
            </div>
            <div class="kpi-card kpi-blue">
                <div class="kpi-icon">‚úì</div>
                <div class="kpi-content">
                    <div class="kpi-label">Efici√™ncia</div>
                    <div class="kpi-value" id="eficiencia">--%</div>
                    <div class="kpi-subtitle">Dentro da faixa programada</div>
                </div>
            </div>
        </div>

        <!-- Gr√°fico Principal -->
        <div class="card">
            <h2 style="text-align: left;">Realizado vs Programado</h2>
            <canvas id="mainChart"></canvas>
        </div>

        <!-- Heatmap de Desvios -->
        <div class="card">
            <h2>Heatmap de Desvios</h2>
            <div class="heatmap-legend">
                üü¢ Dentro do Programado | üü° Desvio Moderado | üî¥ Desvio Alto
            </div>
            <div id="heatmap" class="heatmap-grid"></div>
        </div>

        <!-- Tabela Resumo Estat√≠stico -->
        <div class="card">
            <h2>Resumo Estat√≠stico da Gera√ß√£o por Per√≠odo</h2>
            <table class="stats-table">
                <thead>
                    <tr>
                        <th>Per√≠odo</th>
                        <th>Realizada M√©dia (MW)</th>
                        <th>Programada M√©dia (MW)</th>
                        <th>Desvio M√©dio (MW)</th>
                    </tr>
                </thead>
                <tbody id="statsTableBody">
                    <tr>
                        <td>Madrugada (00h-06h)</td>
                        <td>--</td>
                        <td>--</td>
                        <td>--</td>
                    </tr>
                    <tr>
                        <td>Manh√£ (06h-12h)</td>
                        <td>--</td>
                        <td>--</td>
                        <td>--</td>
                    </tr>
                    <tr>
                        <td>Tarde (12h-18h)</td>
                        <td>--</td>
                        <td>--</td>
                        <td>--</td>
                    </tr>
                    <tr>
                        <td>Noite (18h-00h)</td>
                        <td>--</td>
                        <td>--</td>
                        <td>--</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Controle da Gera√ß√£o -->
        <div class="card control-card">
            <div class="control-header-section">
                <h2>Controle da Gera√ß√£o <span id="controlsCount" class="control-count">(0)</span></h2>
                <div class="no-print">
                    <button id="addControlBtn" class="btn btn-sm btn-primary">‚ûï Adicionar Controle</button>
                    <button id="uploadControlBtn" class="btn btn-sm btn-secondary">Carregar Excel</button>
                    <button id="downloadControlBtn" class="btn btn-sm btn-secondary">Download Excel</button>
                    <button id="deleteAllControlBtn" class="btn btn-sm btn-danger">Excluir Todos</button>
                    <input type="file" id="controlFileInput" accept=".xlsx,.xls" style="display: none;">
                </div>
            </div>

            <!-- Linha do Tempo -->
            <div id="timelineContainer" class="timeline-container"></div>

            <!-- Lista de Controles -->
            <div id="generationControlsList" class="controls-list"></div>
        </div>

        <!-- Sistema de Observa√ß√µes -->
        <div class="card observations-card">
            <div class="observations-header">
                <h2>Observa√ß√µes <span id="obsCount" class="obs-count">(0)</span></h2>
                <div class="no-print">
                    <button id="uploadObsBtn" class="btn btn-sm btn-secondary">Carregar Observa√ß√µes</button>
                    <button id="downloadObsBtn" class="btn btn-sm btn-secondary">Download Observa√ß√µes</button>
                    <button id="deleteAllObsBtn" class="btn btn-sm btn-danger">Excluir Todas</button>
                    <input type="file" id="obsFileInput" accept=".xlsx,.xls" style="display: none;">
                </div>
            </div>
            <div id="observationsList" class="observations-list"></div>
        </div>
    </div>

    <!-- Modal de Observa√ß√£o -->
    <div id="obsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Adicionar Observa√ß√£o</h2>
                <button class="modal-close" id="closeModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Hora:</label>
                    <input type="text" id="obsHora" readonly>
                </div>
                <div class="form-group">
                    <label>Gera√ß√£o (MW):</label>
                    <input type="text" id="obsGeracao" readonly>
                </div>
                <div class="form-group">
                    <label>PDP (MW):</label>
                    <input type="text" id="obsPdp" readonly>
                </div>
                <div class="form-group">
                    <label>Desvio (MW):</label>
                    <input type="text" id="obsDesvio" readonly>
                </div>
                <div class="form-group">
                    <label>Observa√ß√£o:</label>
                    <textarea id="obsTexto" rows="4" placeholder="Digite a observa√ß√£o..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button id="cancelObsBtn" class="btn btn-secondary">Cancelar</button>
                <button id="saveObsBtn" class="btn btn-primary">Salvar</button>
            </div>
        </div>
    </div>

    <!-- Modal de Controle da Gera√ß√£o -->
    <div id="controlModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="controlModalTitle">Adicionar Controle da Gera√ß√£o</h2>
                <button class="modal-close" id="closeControlModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label><span style="color: red;">*</span> Hora:</label>
                    <input type="time" id="controlHora" required>
                </div>
                <div class="form-group">
                    <label><span style="color: red;">*</span> Set-point (MW):</label>
                    <input type="number" id="controlSetpoint" step="1" placeholder="Ex: 1790" required>
                </div>
                <div class="form-group">
                    <label><span style="color: red;">*</span> Respons√°vel:</label>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="controlResponsavel" value="ONS" checked>
                            <span class="radio-label">üè¢ ONS</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="controlResponsavel" value="Axia Energia">
                            <span class="radio-label">‚ö° Axia Energia</span>
                        </label>
                    </div>
                </div>
                <div class="form-group">
                    <label>Detalhe:</label>
                    <textarea id="controlDetalhe" rows="4" placeholder="Detalhamento da solicita√ß√£o (opcional)"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button id="cancelControlBtn" class="btn btn-secondary">Cancelar</button>
                <button id="saveControlBtn" class="btn btn-primary">Salvar</button>
            </div>
        </div>

        <!-- Rodap√© -->
        <footer class="footer no-print">
            <div class="footer-content">
                <span class="version-badge">v0.1.0</span>
                <span class="footer-text">UHE Teles Pires - Sistema de Monitoramento e Controle de Gera√ß√£o</span>
            </div>
        </footer>
    </div>

    <script src="js/generation-control.js"></script>
    <script src="js/script.js"></script>
</body>
</html>
